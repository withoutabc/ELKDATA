input {
  file {
    path => "/path/to/your/log/file.log"  # 替换为你的日志文件路径
    start_position => "beginning"
    sincedb_path => "/dev/null"
  }
}

filter {
  if "visit" in [message] {
    grok {
      match => { "message" => "[GIN] %{TIMESTAMP_ISO8601:log_timestamp} \| %{NUMBER:status_code} \| %{DATA:response_time} \| %{IP:client_ip} \| %{GREEDYDATA:request_path}" }
    }
    date {
      match => [ "log_timestamp", "YYYY-MM-dd'T'HH:mm:ssZ" ]
      target => "@timestamp"
    }
    geoip {
      source => "client_ip"
      target => "geoip"
    }
    mutate {
      add_field => {
        "index_name" => "visit"  # 用于指定Elasticsearch索引名称
      }
    }
  } else if "ip" in [message] {
    grok {
      match => { "message" => "[GIN] %{TIMESTAMP_ISO8601:log_timestamp} \| %{NUMBER:status_code} \| %{DATA:response_time} \| %{IP:client_ip} \| %{GREEDYDATA:request_path}" }
    }
    date {
      match => [ "log_timestamp", "YYYY-MM-dd'T'HH:mm:ssZ" ]
      target => "@timestamp"
    }
    geoip {
      source => "client_ip"
      target => "geoip"
    }
    mutate {
      add_field => {
        "index_name" => "ip"  # 用于指定Elasticsearch索引名称
      }
    }
  } else {
    drop {}
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]  # 替换为你的Elasticsearch主机和端口
    index => "%{index_name}"
  }
}
